---
title: pymysql.err.InternalError) (1366, "Incorrect string valueè§£å†³æ–¹æ³•
date: 2020-04-19 18:14:02
tags:
  - mysql
  - python
---

ä»Šå¤©å°è¯•ç”¨äº†ä¸‹flaskï¼Œç»“æœè¿mysqlæŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š`pymysql.err.InternalError) (1366, "Incorrect string value:`ï¼Œçœ‹èµ·æ¥åƒæ˜¯å­—ç¬¦é›†çš„é—®é¢˜ï¼Œä¹ŸGoogleäº†ä¸‹

<!-- more -->

ç¡®å®æ˜¯å­—ç¬¦é›†çš„é—®é¢˜ï¼Œæˆ‘è¿™é‡Œå®šä¹‰çš„å­—æ®µæ˜¯Stringï¼Œinsertä¸­æ–‡å°±ä¸OKã€‚Googleç»“è®ºæ˜¯MySQLé»˜è®¤çš„charset utf8 ä¸º utf8mb3ï¼Œéœ€è¦è°ƒæ•´ä¸ºutf8mb4ï¼Œå…·ä½“çš„å¤§å®¶çœ‹è¿™ä¸ªå›ç­”[https://stackoverflow.com/questions/10957238/incorrect-string-value-when-trying-to-insert-utf-8-into-mysql-via-jdbc](https://stackoverflow.com/questions/10957238/incorrect-string-value-when-trying-to-insert-utf-8-into-mysql-via-jdbc)ã€‚

æ€ä¹ˆä¿®æ”¹ï¼Ÿå°è¯•æ­¥éª¤å¦‚ä¸‹

```
$ mysql> show variables like 'character%';
+--------------------------+-----------------------------------------------------------+
| Variable_name            | Value                                                     |
+--------------------------+-----------------------------------------------------------+
| character_set_client     | utf8                                                   
|
| character_set_connection | utf8                                                   
|
| character_set_database   | latin1                                                    
|
| character_set_filesystem | binary                                                    
|
| character_set_results    | utf8                                                   
|
| character_set_server     | utf8                                                   
|
| character_set_system     | utf8                                                      |
| character_sets_dir       | /usr/local/mysql-5.7.25-macos10.14-x86_64/share/charsets/ |
+--------------------------+-----------------------------------------------------------+
8 rows in set (0.00 sec)

$ alter database test charset utf8mb4;
$ show variables like 'character%';
+--------------------------+-----------------------------------------------------------+
| Variable_name            | Value                                                     |
+--------------------------+-----------------------------------------------------------+
| character_set_client     | utf8                                                   
|
| character_set_connection | utf8                                                   
|
| character_set_database   | utf8mb64                                                  
|
| character_set_filesystem | binary                                                    
|
| character_set_results    | utf8                                                   
|
| character_set_server     | utf8                                                   
|
| character_set_system     | utf8                                                      |
| character_sets_dir       | /usr/local/mysql-5.7.25-macos10.14-x86_64/share/charsets/ |
+--------------------------+-----------------------------------------------------------+
8 rows in set (0.00 sec)
```
ç„¶åå°è¯•insertä¸­æ–‡ï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œåæ¥åˆalertäº†tableï¼Œæœ€åalertè¡¨é‡Œå…·ä½“çš„columnï¼Œä½†æ˜¯è¿™ä¹ˆæä¸èƒ½ä¸€åŠ³æ°¸é€¸å•Šï¼Œæ€ä¹ˆåŠï¼Ÿè¿™é‡Œå›åˆ°æœ€å¼€å§‹ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„æ˜¯mysqlçš„å­—ç¬¦é›†ï¼Œæ‰€ä»¥åº”è¯¥æ”¹mysqlçš„é…ç½®æ–‡ä»¶ã€‚

ç½‘ä¸Šæœç´¢äº†ä¸‹ï¼ŒMacä¸ŠMySQLçš„é…ç½®æ–‡ä»¶è·¯å¾„ä¸º`/usr/local/mysql/support-files/my-default.cnf`ï¼Œå¯æ˜¯æˆ‘è¿™å¹¶æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œé‚æ–°å»ºäº†`/etc/my.cnf`ï¼Œå†…å®¹å¦‚ä¸‹
```
[client]
default-character-set=utf8mb4
[mysqld]
character-set-server=utf8mb4
```

æ–°å»ºå‰éœ€è¦stopä¸‹MySQLï¼Œæ–°å»ºå®Œæˆåé‡å¯MySQLï¼Œç„¶åå°±okäº†å—ï¼ŸæŒ‰ç†åº”è¯¥æ˜¯çš„ï¼Œä¸è¿‡æˆ‘è¿™é‡Œå¹¶æ²¡æœ‰okå•Šï¼ï¼ï¼

æƒ³äº†ä¸€æƒ³ï¼Œåˆšæ‰æ–°å»ºçš„testæ•°æ®åº“åº”è¯¥éœ€è¦é‡å»ºï¼Œæˆ–è€…é‡å»ºå¯¹åº”çš„tableã€‚ç²—æš´äº†ä¸€ç‚¹ï¼Œ`drop database test;`ï¼Œç„¶åå†createï¼Œç„¶åç„¶åå°±okäº†ï¼Œå“ˆå“ˆå“ˆğŸ˜

```
$ mysql> select * from role;
+----+-----------------+-------+---------------------+
| id | name            | auths | addtime             |
+----+-----------------+-------+---------------------+
|  1 | è¶…çº§ç®¡ç†å‘˜      |       | 2020-04-18 10:07:48 |
+----+-----------------+-------+---------------------+
1 row in set (0.00 sec)
```

è¿™é‡Œä»…åšè®°å½•ï¼Œé‡åˆ°ç›¸åŒé—®é¢˜çš„åŒå­¦å¯ä»¥å‚è€ƒä¸‹ã€‚

ç”Ÿäº§é¡¹ç›®æ²¡è¿™ä¹ˆéº»çƒ¦ï¼Œç›´æ¥äº‘æ•°æ®åº“å°±å¥½ğŸ˜‚
